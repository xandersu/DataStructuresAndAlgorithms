# 第4章 堆和堆排序

普通队列：先进先出、后进先出

优先队列：出队顺序和入队顺序无关；和优先级相关

关键词：动态

### 优先队列主要操作

- 入队

- 出队（取出优先级最高的元素）

|          | 入队    | 出队    |
| -------- | ------- | ------- |
| 普通数组 | O(1)    | O(n)    |
| 顺序数组 | O(n)    | O(1)    |
| 堆       | O(logn) | O(logn) |



对于总共N个请求：

使用普通数组或者顺序数组，最差情况：O(n^2)

使用堆：O(nlgn)



## 堆的基本实现

### 二叉堆 Binary Heap

二叉堆是一颗完全二叉树（完全二叉树：二叉树，除了最后一层之外，其他层所有个数必须是最大值）。

最大堆：堆中某个节点的值总是不大于其父节点的值。（最大堆：不意味着越往上越大）

> 一棵深度为k的有n个结点的[二叉树](https://baike.baidu.com/item/二叉树/1602879)，对树中的结点按从上至下、从左到右的顺序进行编号，如果编号为i（1≤i≤n）的结点与满二叉树中编号为i的结点在二叉树中的位置相同，则这棵二叉树称为完全二叉树。



### 用数组存储二叉堆



![USWkZV.png](https://s1.ax1x.com/2020/07/05/USWkZV.png)

数组从1开始

parent(i) = i/2;

left child (i) = 2*i;

right child (i) = 2*i+1; 



## Shift Up

插入元素，并且使堆保持最大堆的定义

1.插入尾部

2.依次和自己的父元素进行比较



[![JzQbdg.png](https://s1.ax1x.com/2020/05/03/JzQbdg.png)](https://imgchr.com/i/JzQbdg)



## Shift Down

堆中取出一个元素。

1.取出根节点，返回

2.保持最大堆定义，将最后一个放到根节点，将跟节点与子节点比较，左右两个孩子谁大跟谁换，一步一步向下挪动



## Heapify

给定一个数组，将数组排列成堆的结构

### Heaplify的算法复杂度

将n个元素逐一插入到一个空堆中，算法复杂度是O(nlogn)

Heaplify的过程，算法复杂度O(n)



## 原地堆排序

数组从0开始

parent(i) = (i-1)/2

left child (i) = 2*i+1

right child (i) = 2*i+2

最后一个非叶子节点(count-1)/2



## 排序算法总结

| 排序方法                     | 平均时间复杂度 | 原地排序 | 额外空间 | 稳定性 |
| ---------------------------- | -------------- | -------- | -------- | ------ |
| 插入排序<br />Insertion Sort | O(n^2)         | 是       | O(1)     | 是     |
| 归并排序<br />Merge Sort     | O(nlogn)       | 否       | O(n)     | 是     |
| 快速排序 <br />Quick Sort    | O(nlogn)       | 是       | O(logn)  | 否     |
| 堆排序 <br />Heap Sort       | O(nlogn)       | 是       | O(1)     | 否     |

#### 平均时间复杂度：

插入排序在数组近似有序的情况下，时间复杂度是O(n)。

快速排序在特定情况下回退化为O(n^2)，使用随机点的办法使得O(n^2)出现概率极低。

总体上，快速排序是最快的，对于都是O(nlogn)的排序方法都有常数上的差别，在这个常数，快排最小。

在存在大量相同数时可以使用三路快排

#### 是否是原地排序：

归并不是原地排序，必须使用额外的空间。如果一个系统内存敏感，归并排序不适用。

#### 额外空间

归并排序是O(n+logn),因为logn比n小，所以logn忽略不计。

快速排序是O(logn)，因为我们采用的方式排序，这个递归一共有logn这么多层，需要用logn这么多的栈空间保存变量。

#### 稳定性

对于相等的元素，在排序后，原来靠前的元素依然靠前

相等的元素相对位置没有改变。



## 索引堆





















































